generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model chi_tiet_hoc_phi {
  id              String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  hoc_phi_id      String       @db.Uuid
  lop_hoc_phan_id String       @db.Uuid
  so_tin_chi      Int
  phi_tin_chi     Decimal      @db.Decimal(10, 2)
  thanh_tien      Decimal      @db.Decimal(12, 2)
  hoc_phi         hoc_phi      @relation(fields: [hoc_phi_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lop_hoc_phan    lop_hoc_phan @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([hoc_phi_id, lop_hoc_phan_id])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model chi_tiet_lich_su_dang_ky {
  id                  String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  lich_su_dang_ky_id  String           @db.Uuid
  dang_ky_hoc_phan_id String           @db.Uuid
  hanh_dong           String           @db.VarChar(20)
  thoi_gian           DateTime?        @default(now()) @db.Timestamp(6)
  dang_ky_hoc_phan    dang_ky_hoc_phan @relation(fields: [dang_ky_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lich_su_dang_ky     lich_su_dang_ky  @relation(fields: [lich_su_dang_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model chinh_sach_tin_chi {
  id                String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  hoc_ky_id         String?    @db.Uuid
  khoa_id           String?    @db.Uuid
  nganh_id          String?    @db.Uuid
  phi_moi_tin_chi   Decimal    @db.Decimal(12, 2)
  ngay_hieu_luc     DateTime   @default(dbgenerated("CURRENT_DATE")) @db.Date
  ngay_het_hieu_luc DateTime?  @db.Date
  hoc_ky            hoc_ky?    @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa              khoa?      @relation(fields: [khoa_id], references: [id], onUpdate: NoAction)
  nganh_hoc         nganh_hoc? @relation(fields: [nganh_id], references: [id], onUpdate: NoAction)
  hoc_phi           hoc_phi[]
}

model co_so {
  id        String  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ten_co_so String
  dia_chi   String?
  phong     phong[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model dang_ky_hoc_phan {
  id                       String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sinh_vien_id             String                     @db.Uuid
  lop_hoc_phan_id          String                     @db.Uuid
  ngay_dang_ky             DateTime?                  @default(now()) @db.Timestamp(6)
  trang_thai               String?                    @default("da_dang_ky") @db.VarChar(20)
  co_xung_dot              Boolean?                   @default(false)
  chi_tiet_lich_su_dang_ky chi_tiet_lich_su_dang_ky[]
  lop_hoc_phan             lop_hoc_phan               @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien                sinh_vien                  @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  dang_ky_tkb              dang_ky_tkb[]

  @@unique([sinh_vien_id, lop_hoc_phan_id])
  @@index([lop_hoc_phan_id], map: "idx_dkhp_lhp")
  @@index([sinh_vien_id], map: "idx_dkhp_sv")
}

/// This table contains exclusion constraints and requires additional setup for migrations. Visit https://pris.ly/d/exclusion-constraints for more info.
model dang_ky_tkb {
  id               String                   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  dang_ky_id       String                   @db.Uuid
  sinh_vien_id     String                   @db.Uuid
  lop_hoc_phan_id  String                   @db.Uuid
  thu              Int
  tiet_range       Unsupported("int4range")
  hieu_luc         Boolean?                 @default(true)
  dang_ky_hoc_phan dang_ky_hoc_phan         @relation(fields: [dang_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lop_hoc_phan     lop_hoc_phan             @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien        sinh_vien                @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model dot_dang_ky {
  id                   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  hoc_ky_id            String    @db.Uuid
  loai_dot             String    @default("dang_ky") @db.VarChar(20)
  gioi_han_tin_chi     Int?      @default(9999)
  thoi_gian_bat_dau    DateTime  @db.Timestamp(6)
  thoi_gian_ket_thuc   DateTime  @db.Timestamp(6)
  han_huy_den          DateTime? @db.Timestamp(6)
  created_at           DateTime? @default(now()) @db.Timestamp(6)
  updated_at           DateTime? @default(now()) @db.Timestamp(6)
  is_check_toan_truong Boolean   @default(true)
  khoa_id              String?   @db.Uuid
  hoc_ky               hoc_ky    @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa                 khoa?     @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_dotdk_khoa")

  @@index([hoc_ky_id], map: "idx_dotdk_hk")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ghi_danh_hoc_phan {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sinh_vien_id  String    @db.Uuid
  hoc_phan_id   String    @db.Uuid
  ngay_ghi_danh DateTime? @default(now()) @db.Timestamp(6)
  trang_thai    String?   @default("da_ghi_danh") @db.VarChar(20)
  hoc_phan      hoc_phan  @relation(fields: [hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien     sinh_vien @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([sinh_vien_id, hoc_phan_id])
  @@index([sinh_vien_id, hoc_phan_id], map: "idx_gd_hp_sv")
}

model giang_vien {
  id                    String                @id @db.Uuid
  khoa_id               String                @db.Uuid
  chuyen_mon            String?
  trinh_do              String?               @db.VarChar(50)
  kinh_nghiem_giang_day Int?                  @default(0)
  de_xuat_hoc_phan      de_xuat_hoc_phan[]
  de_xuat_hoc_phan_gv   de_xuat_hoc_phan_gv[]
  users                 users                 @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa                  khoa                  @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lop_hoc_phan          lop_hoc_phan[]

  @@index([khoa_id], map: "idx_gv_khoa")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model hoc_ky {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ten_hoc_ky           String                 @db.VarChar(50)
  ma_hoc_ky            String                 @db.VarChar(10)
  id_nien_khoa         String                 @db.Uuid
  ngay_bat_dau         DateTime?              @db.Date
  ngay_ket_thuc        DateTime?              @db.Date
  trang_thai_hien_tai  Boolean?               @default(false)
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  chinh_sach_tin_chi   chinh_sach_tin_chi[]
  de_xuat_hoc_phan     de_xuat_hoc_phan[]
  dot_dang_ky          dot_dang_ky[]
  nien_khoa            nien_khoa              @relation(fields: [id_nien_khoa], references: [id], onDelete: Cascade, onUpdate: NoAction)
  hoc_phan             hoc_phan[]
  hoc_phi              hoc_phi[]
  ket_qua_hoc_phan     ket_qua_hoc_phan[]
  ky_phase             ky_phase[]
  lich_su_dang_ky      lich_su_dang_ky[]
  payment_transactions payment_transactions[]

  @@unique([ma_hoc_ky, id_nien_khoa])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model hoc_phan {
  id                String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  mon_hoc_id        String              @db.Uuid
  ten_hoc_phan      String              @db.VarChar(255)
  so_lop            Int?                @default(1)
  trang_thai_mo     Boolean?            @default(false)
  id_hoc_ky         String              @db.Uuid
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  updated_at        DateTime?           @default(now()) @db.Timestamp(6)
  ghi_danh_hoc_phan ghi_danh_hoc_phan[]
  hoc_ky            hoc_ky              @relation(fields: [id_hoc_ky], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mon_hoc           mon_hoc             @relation(fields: [mon_hoc_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lop_hoc_phan      lop_hoc_phan[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model hoc_phi {
  id                    String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sinh_vien_id          String              @db.Uuid
  hoc_ky_id             String              @db.Uuid
  tong_hoc_phi          Decimal?            @default(0) @db.Decimal(15, 2)
  trang_thai_thanh_toan String?             @default("chua_thanh_toan") @db.VarChar(20)
  ngay_tinh_toan        DateTime?           @default(now()) @db.Timestamp(6)
  ngay_thanh_toan       DateTime?           @db.Timestamp(6)
  chinh_sach_id         String?             @db.Uuid
  ghi_chu               String?
  chi_tiet_hoc_phi      chi_tiet_hoc_phi[]
  chinh_sach_tin_chi    chinh_sach_tin_chi? @relation(fields: [chinh_sach_id], references: [id], onUpdate: NoAction)
  hoc_ky                hoc_ky              @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien             sinh_vien           @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([sinh_vien_id, hoc_ky_id])
  @@index([sinh_vien_id], map: "idx_hocphi_sv")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ket_qua_hoc_phan {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sinh_vien_id    String        @db.Uuid
  mon_hoc_id      String        @db.Uuid
  hoc_ky_id       String?       @db.Uuid
  lop_hoc_phan_id String?       @db.Uuid
  diem_so         Decimal?      @db.Decimal(4, 2)
  trang_thai      String?       @db.VarChar(20)
  hoc_ky          hoc_ky?       @relation(fields: [hoc_ky_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lop_hoc_phan    lop_hoc_phan? @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  mon_hoc         mon_hoc       @relation(fields: [mon_hoc_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien       sinh_vien     @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([sinh_vien_id, mon_hoc_id, hoc_ky_id])
}

model khoa {
  id                   String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ma_khoa              String               @unique @db.VarChar(10)
  ten_khoa             String               @db.VarChar(255)
  ngay_thanh_lap       DateTime?            @db.Date
  trang_thai_hoat_dong Boolean?             @default(true)
  created_at           DateTime?            @default(now()) @db.Timestamp(6)
  updated_at           DateTime?            @default(now()) @db.Timestamp(6)
  chinh_sach_tin_chi   chinh_sach_tin_chi[]
  de_xuat_hoc_phan     de_xuat_hoc_phan[]
  dot_dang_ky          dot_dang_ky[]
  giang_vien           giang_vien[]
  mon_hoc              mon_hoc[]
  nganh_hoc            nganh_hoc[]
  sinh_vien            sinh_vien[]
  tro_ly_khoa          tro_ly_khoa[]
  truong_khoa          truong_khoa?
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ky_phase {
  id         String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  hoc_ky_id  String   @db.Uuid
  phase      String   @db.VarChar(30)
  start_at   DateTime @db.Timestamp(6)
  end_at     DateTime @db.Timestamp(6)
  is_enabled Boolean? @default(true)
  hoc_ky     hoc_ky   @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([hoc_ky_id, phase])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lich_day_lop_hoc_phan {
  id              String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  lop_hoc_phan_id String       @db.Uuid
  ngay_hoc        DateTime     @db.Date
  thu             Int?
  tiet_bat_dau    Int?
  tiet_ket_thuc   Int?
  phong_id        String?      @db.Uuid
  lop_hoc_phan    lop_hoc_phan @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  phong           phong?       @relation(fields: [phong_id], references: [id], onUpdate: NoAction)

  @@unique([lop_hoc_phan_id, ngay_hoc])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This table contains exclusion constraints and requires additional setup for migrations. Visit https://pris.ly/d/exclusion-constraints for more info.
model lich_hoc_dinh_ky {
  id              String                    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  lop_hoc_phan_id String                    @db.Uuid
  thu             Int
  tiet_bat_dau    Int
  tiet_ket_thuc   Int
  phong_id        String?                   @db.Uuid
  tuan_bat_dau    Int?
  tuan_ket_thuc   Int?
  gio_bat_dau     DateTime?                 @db.Time(6)
  gio_ket_thuc    DateTime?                 @db.Time(6)
  tiet_range      Unsupported("int4range")? @default(dbgenerated("int4range(tiet_bat_dau, tiet_ket_thuc, '[]'::text)"))
  lop_hoc_phan    lop_hoc_phan              @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  phong           phong?                    @relation(fields: [phong_id], references: [id], onUpdate: NoAction)

  @@unique([lop_hoc_phan_id, thu, tiet_bat_dau, tiet_ket_thuc])
  @@index([lop_hoc_phan_id], map: "idx_lhdk_lhp")
}

model lich_su_dang_ky {
  id                       String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  sinh_vien_id             String                     @db.Uuid
  hoc_ky_id                String?                    @db.Uuid
  ngay_tao                 DateTime?                  @default(now()) @db.Timestamp(6)
  chi_tiet_lich_su_dang_ky chi_tiet_lich_su_dang_ky[]
  hoc_ky                   hoc_ky?                    @relation(fields: [hoc_ky_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sinh_vien                sinh_vien                  @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([sinh_vien_id, hoc_ky_id])
}

model lich_su_xoa_lop_hoc_phan {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  lop_hoc_phan_id   String    @db.Uuid
  ma_lop            String?   @db.VarChar(50)
  ten_hoc_phan      String?
  ten_giang_vien    String?
  so_luong_toi_da   Int?
  so_luong_hien_tai Int?
  phong_hoc         String?
  ngay_hoc          String[]
  gio_hoc           String?
  ngay_bat_dau      DateTime? @db.Date
  ngay_ket_thuc     DateTime? @db.Date
  tong_so_tiet      Int?
  dia_diem          String?
  nguoi_xoa         String?   @db.Uuid
  thoi_gian_xoa     DateTime? @default(now()) @db.Timestamp(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lop_hoc_phan {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  hoc_phan_id           String                  @db.Uuid
  ma_lop                String                  @db.VarChar(20)
  giang_vien_id         String?                 @db.Uuid
  so_luong_toi_da       Int?                    @default(50)
  so_luong_hien_tai     Int?                    @default(0)
  phong_mac_dinh_id     String?                 @db.Uuid
  trang_thai_lop        String?                 @default("dang_mo") @db.VarChar(20)
  ngay_bat_dau          DateTime?               @db.Date
  ngay_ket_thuc         DateTime?               @db.Date
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @default(now()) @db.Timestamp(6)
  chi_tiet_hoc_phi      chi_tiet_hoc_phi[]
  dang_ky_hoc_phan      dang_ky_hoc_phan[]
  dang_ky_tkb           dang_ky_tkb[]
  ket_qua_hoc_phan      ket_qua_hoc_phan[]
  lich_day_lop_hoc_phan lich_day_lop_hoc_phan[]
  lich_hoc_dinh_ky      lich_hoc_dinh_ky[]
  giang_vien            giang_vien?             @relation(fields: [giang_vien_id], references: [id], onUpdate: NoAction)
  hoc_phan              hoc_phan                @relation(fields: [hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  phong                 phong?                  @relation(fields: [phong_mac_dinh_id], references: [id], onUpdate: NoAction)
  tai_lieu              tai_lieu[]
  thong_bao             thong_bao[]

  @@unique([hoc_phan_id, ma_lop])
  @@index([giang_vien_id], map: "idx_lhp_gv")
  @@index([hoc_phan_id], map: "idx_lhp_hocphan")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model mon_dieu_kien {
  id                                              String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  mon_hoc_id                                      String   @db.Uuid
  mon_lien_quan_id                                String   @db.Uuid
  loai                                            String   @db.VarChar(20)
  bat_buoc                                        Boolean? @default(true)
  mon_hoc_mon_dieu_kien_mon_hoc_idTomon_hoc       mon_hoc  @relation("mon_dieu_kien_mon_hoc_idTomon_hoc", fields: [mon_hoc_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mon_hoc_mon_dieu_kien_mon_lien_quan_idTomon_hoc mon_hoc  @relation("mon_dieu_kien_mon_lien_quan_idTomon_hoc", fields: [mon_lien_quan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([mon_hoc_id, mon_lien_quan_id, loai])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model mon_hoc {
  id                                                    String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ma_mon                                                String             @unique @db.VarChar(20)
  ten_mon                                               String             @db.VarChar(255)
  so_tin_chi                                            Int
  khoa_id                                               String             @db.Uuid
  loai_mon                                              String?            @default("chuyen_nganh") @db.VarChar(50)
  la_mon_chung                                          Boolean?           @default(false)
  thu_tu_hoc                                            Int?               @default(1)
  created_at                                            DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                                            DateTime?          @default(now()) @db.Timestamp(6)
  de_xuat_hoc_phan                                      de_xuat_hoc_phan[]
  hoc_phan                                              hoc_phan[]
  ket_qua_hoc_phan                                      ket_qua_hoc_phan[]
  mon_dieu_kien_mon_dieu_kien_mon_hoc_idTomon_hoc       mon_dieu_kien[]    @relation("mon_dieu_kien_mon_hoc_idTomon_hoc")
  mon_dieu_kien_mon_dieu_kien_mon_lien_quan_idTomon_hoc mon_dieu_kien[]    @relation("mon_dieu_kien_mon_lien_quan_idTomon_hoc")
  khoa                                                  khoa               @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mon_hoc_nganh                                         mon_hoc_nganh[]

  @@index([khoa_id], map: "idx_mon_khoa")
}

model mon_hoc_nganh {
  id         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  mon_hoc_id String    @db.Uuid
  nganh_id   String    @db.Uuid
  mon_hoc    mon_hoc   @relation(fields: [mon_hoc_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  nganh_hoc  nganh_hoc @relation(fields: [nganh_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([mon_hoc_id, nganh_id])
}

model nganh_hoc {
  id                 String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ma_nganh           String               @unique @db.VarChar(20)
  ten_nganh          String               @db.VarChar(255)
  khoa_id            String               @db.Uuid
  created_at         DateTime?            @default(now()) @db.Timestamp(6)
  updated_at         DateTime?            @default(now()) @db.Timestamp(6)
  chinh_sach_tin_chi chinh_sach_tin_chi[]
  mon_hoc_nganh      mon_hoc_nganh[]
  khoa               khoa                 @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien          sinh_vien[]
}

model nien_khoa {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ten_nien_khoa String    @unique @db.VarChar(20)
  ngay_bat_dau  DateTime? @db.Date
  ngay_ket_thuc DateTime? @db.Date
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  hoc_ky        hoc_ky[]
}

model payment_ipn_logs {
  id                   String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  transaction_id       String?               @db.Uuid
  received_at          DateTime?             @default(now()) @db.Timestamp(6)
  payload              Json?
  payment_transactions payment_transactions? @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model payment_transactions {
  id               String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  provider         String?            @default("momo") @db.VarChar(20)
  order_id         String             @unique
  sinh_vien_id     String             @db.Uuid
  hoc_ky_id        String             @db.Uuid
  amount           Decimal            @db.Decimal(15, 2)
  currency         String?            @default("VND") @db.VarChar(10)
  status           String             @default("created") @db.VarChar(20)
  payment_method   String?            @db.VarChar(30)
  pay_url          String?
  result_code      String?
  message          String?
  callback_raw     Json?
  signature_valid  Boolean?
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @db.Timestamp(6)
  payment_ipn_logs payment_ipn_logs[]
  hoc_ky           hoc_ky             @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sinh_vien        sinh_vien          @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sinh_vien_id], map: "idx_payment_sv")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model phong {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ma_phong              String                  @db.VarChar(20)
  co_so_id              String?                 @db.Uuid
  suc_chua              Int?
  da_dc_su_dung         Boolean?                @default(false)
  lich_day_lop_hoc_phan lich_day_lop_hoc_phan[]
  lich_hoc_dinh_ky      lich_hoc_dinh_ky[]
  lop_hoc_phan          lop_hoc_phan[]
  co_so                 co_so?                  @relation(fields: [co_so_id], references: [id], onUpdate: NoAction)

  @@unique([ma_phong, co_so_id])
}

model phong_dao_tao {
  id      String  @id @db.Uuid
  chuc_vu String? @db.VarChar(100)
  users   users   @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model sinh_vien {
  id                   String                 @id @db.Uuid
  ma_so_sinh_vien      String                 @unique @db.VarChar(20)
  lop                  String?                @db.VarChar(50)
  khoa_id              String                 @db.Uuid
  khoa_hoc             String?                @db.VarChar(10)
  ngay_nhap_hoc        DateTime?              @db.Date
  nganh_id             String?                @db.Uuid
  dang_ky_hoc_phan     dang_ky_hoc_phan[]
  dang_ky_tkb          dang_ky_tkb[]
  ghi_danh_hoc_phan    ghi_danh_hoc_phan[]
  hoc_phi              hoc_phi[]
  ket_qua_hoc_phan     ket_qua_hoc_phan[]
  lich_su_dang_ky      lich_su_dang_ky[]
  payment_transactions payment_transactions[]
  users                users                  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa                 khoa                   @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  nganh_hoc            nganh_hoc?             @relation(fields: [nganh_id], references: [id], onUpdate: NoAction)
  thong_bao_nguoi_nhan thong_bao_nguoi_nhan[]

  @@index([khoa_id], map: "idx_sv_khoa")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tai_khoan {
  id                   String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ten_dang_nhap        String        @unique @db.VarChar(50)
  mat_khau             String        @db.VarChar(255)
  loai_tai_khoan       String        @db.VarChar(20)
  trang_thai_hoat_dong Boolean?      @default(true)
  ngay_tao             DateTime?     @default(now()) @db.Timestamp(6)
  updated_at           DateTime?     @default(now()) @db.Timestamp(6)
  reset_token          reset_token[]
  users                users[]
}

model tai_lieu {
  id              String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  lop_hoc_phan_id String       @db.Uuid
  ten_tai_lieu    String
  file_path       String
  file_type       String?
  uploaded_by     String?      @db.Uuid
  created_at      DateTime?    @default(now()) @db.Timestamp(6)
  lop_hoc_phan    lop_hoc_phan @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           users?       @relation(fields: [uploaded_by], references: [id], onUpdate: NoAction)
}

model thong_bao {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tieu_de              String
  noi_dung             String
  nguoi_gui_id         String?                @db.Uuid
  lop_hoc_phan_id      String?                @db.Uuid
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  lop_hoc_phan         lop_hoc_phan?          @relation(fields: [lop_hoc_phan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                users?                 @relation(fields: [nguoi_gui_id], references: [id], onUpdate: NoAction)
  thong_bao_nguoi_nhan thong_bao_nguoi_nhan[]
}

model thong_bao_nguoi_nhan {
  id           String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  thong_bao_id String     @db.Uuid
  sinh_vien_id String?    @db.Uuid
  da_doc       Boolean?   @default(false)
  sinh_vien    sinh_vien? @relation(fields: [sinh_vien_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  thong_bao    thong_bao  @relation(fields: [thong_bao_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model tro_ly_khoa {
  id      String @id @db.Uuid
  khoa_id String @db.Uuid
  users   users  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa    khoa   @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model truong_khoa {
  id      String @id @db.Uuid
  khoa_id String @unique @db.Uuid
  users   users  @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa    khoa   @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  ma_nhan_vien         String?                @db.VarChar(20)
  ho_ten               String                 @db.VarChar(255)
  tai_khoan_id         String?                @db.Uuid
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  email                String                 @unique @db.Citext
  de_xuat_hoc_phan     de_xuat_hoc_phan[]
  de_xuat_hoc_phan_log de_xuat_hoc_phan_log[]
  giang_vien           giang_vien?
  phong_dao_tao        phong_dao_tao?
  sinh_vien            sinh_vien?
  tai_lieu             tai_lieu[]
  thong_bao            thong_bao[]
  tro_ly_khoa          tro_ly_khoa?
  truong_khoa          truong_khoa?
  tai_khoan            tai_khoan?             @relation(fields: [tai_khoan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model de_xuat_hoc_phan {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  khoa_id              String                 @db.Uuid
  nguoi_tao_id         String                 @db.Uuid
  hoc_ky_id            String                 @db.Uuid
  mon_hoc_id           String                 @db.Uuid
  so_lop_du_kien       Int
  giang_vien_de_xuat   String?                @db.Uuid
  trang_thai           String?                @default("cho_duyet") @db.VarChar(30)
  cap_duyet_hien_tai   String?                @default("truong_khoa") @db.VarChar(20)
  ghi_chu              String?
  created_at           DateTime?              @default(now()) @db.Timestamp(6)
  updated_at           DateTime?              @default(now()) @db.Timestamp(6)
  giang_vien           giang_vien?            @relation(fields: [giang_vien_de_xuat], references: [id], onUpdate: NoAction)
  hoc_ky               hoc_ky                 @relation(fields: [hoc_ky_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  khoa                 khoa                   @relation(fields: [khoa_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  mon_hoc              mon_hoc                @relation(fields: [mon_hoc_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                users                  @relation(fields: [nguoi_tao_id], references: [id], onDelete: SetNull, onUpdate: NoAction)
  de_xuat_hoc_phan_gv  de_xuat_hoc_phan_gv[]
  de_xuat_hoc_phan_log de_xuat_hoc_phan_log[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model de_xuat_hoc_phan_gv {
  id               String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  de_xuat_id       String           @db.Uuid
  giang_vien_id    String?          @db.Uuid
  so_lop_du_kien   Int?
  de_xuat_hoc_phan de_xuat_hoc_phan @relation(fields: [de_xuat_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  giang_vien       giang_vien?      @relation(fields: [giang_vien_id], references: [id], onUpdate: NoAction)
}

model de_xuat_hoc_phan_log {
  id               String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  de_xuat_id       String           @db.Uuid
  thoi_gian        DateTime?        @default(now()) @db.Timestamp(6)
  hanh_dong        String           @db.VarChar(30)
  nguoi_thuc_hien  String?          @db.Uuid
  ghi_chu          String?
  de_xuat_hoc_phan de_xuat_hoc_phan @relation(fields: [de_xuat_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users            users?           @relation(fields: [nguoi_thuc_hien], references: [id], onUpdate: NoAction)
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

model reset_token {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tai_khoan_id String    @db.Uuid
  token        String    @unique
  expires_at   DateTime  @db.Timestamp(6)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  tai_khoan    tai_khoan @relation(fields: [tai_khoan_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expires_at], map: "idx_reset_token_expires")
}
